# 红黑树

红黑树动态变化演示：https://www.cs.usfca.edu/~galles/visualization/RedBlack.html

## 简介



## 性质

红黑树一般具有一下几个性质：

1.节点是红色或黑色。

2.根节点是黑色。

3.每个叶子节点都是黑色的空节点（NIL节点）。

4 每个红色节点的两个子节点都是黑色。(从每个叶子到根的所有路径上不能有两个连续的红色节点)

5.从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点。



我们先来研究下这五条性质。

先来测试一下根据以上5条性质进行红黑树构建的时候，会出现哪些情况，我们从1开始插入数据，一直插入到10。

## 推导

**插入1**

插入①的时候，整棵树都为空，因此①变为根节点，根据性质2，根节点为黑色。

![](./img/reablacktree/3.png)

**插入2**

插入②，因为②比①大，因此②应该为①的右子树，从图中还可以看出，新添加的节点默认为`红`节点。



![](./img/reablacktree/4.gif)

**插入3**

插入③，③比①和②大，因此③为②的右子树，此时两个`红`节点相连，违法了红黑树第4条性质。看看图中是怎么处理这样的冲突。很容易的可以看出下图进行了两部操作来处理这个问题。一步是旋转，一步是变色。这个时候，读者的脑中是否出现这样的问题呢，即红黑树中插入数据何时该进行旋转何时该进行变色。从下图本文是无法直接得出结论的，因此我们的测试还得继续。

![](./img/reablacktree/5.gif)

**插入4**

插入④，④应该插入到③节点的右子树，此时两个`红`色节点相连，违反了红树的第4条性质。图中直接将斯节点的父节点和叔叔节点以及④的祖父节点变色。这个时候我们是否会产生这样的问题。即为何插入④只需要对父节点、叔叔节点以及祖父节点进行变色就行了，但是插入③的时候却要进行父节点、祖父节点进行变色的同时还要进行旋转呢？仔细观察一下，我们是否可以提出这样的猜想，即在插入③的时候，③的父节点是有兄弟节点，并且兄弟节点为红色，而插入④的时候，④的父节点没有兄弟节点，那么是否是因为插入节点的叔叔节点会影响着此次节点插入是否需要进行旋转呢？现在的实验还不足以验证我们的猜想，还是继续测试吧。

![](./img/reablacktree/6.gif)

**插入5**

插入⑤，⑤应该插入到④的右子节点中，此时两个`红`色节点相连，违反了红树的第4条性质。观看下图对红黑树的调整，可以轻易的发现本次调整既有旋转也有变色。同样再插入⑤节点后，观察到④节点没有兄弟节点，并且颜色变化的节点有⑤节点的父节点与⑤节点的祖父节点。这是否进一步验证了我们在**插入④**的时候的猜想呢？既当插入节点破坏了红黑树的第4条性质后，如果插入节点的父节点没有兄弟节点，此时对红黑树进行调整，既需要变色也需要旋转。

![](./img/reablacktree/7.gif)

**插入6**

插入⑥，⑥应该插入到⑤节点的右子节点中，此时两个`红`色节点相连，违反了红树的第4条性质。将⑥节点的父节点和叔叔节点以及祖父节点进行变色，则恢复了红黑树。

![](./img/reablacktree/8.gif)

**插入7**

![](./img/reablacktree/9.gif)

**插入8**

![](./img/reablacktree/10.gif)

**插入9**

![](./img/reablacktree/11.gif)

**插入10**

![](./img/reablacktree/12.gif)

## 红黑色的旋转

### 左旋转

当红黑树的中某个节点的右子树不符合红黑树的性质并且需要进行旋转调整时，则需要对红黑树进行左旋转以及变色，下图为右旋转的示意图，当插入**greater than 5**后，红黑树的性质被破环，此时需要对红黑树进行右旋转（颜色的变化并未被体现出来）。

![](./img/reablacktree/1.gif)



### 右旋转

当红黑树的中某个节点的左子树不符合红黑树的性质并且需要进行旋转调整时，则需要对红黑树进行右旋转以及变色，下图为右旋转的示意图，当插入**less   than 5**后，红黑树的性质被破环，此时需要对红黑树进行右旋转（颜色的变化并未被体现出来）。

![](./img/reablacktree/2.gif)

## 红黑树被破坏以及恢复

经过大量的验证与分析后，本文得出了红黑树在插入数据被破坏后的几种情况以及调整方案。

### 红黑树被破坏的几种情况

如果插入节点的父节点为红节点，此时红黑树被破坏，红黑树被破坏的情况大致分为两类，即插入节点的父节点有兄弟节点与插入节点的父节点没有兄弟节点。先讨论有兄弟节点的情况。

**父节点有兄弟节点的情况**

**情景一：**父节点的兄弟节点为红色，且插入节点与父节点处于同一直线路径。



![](./img/reablacktree/14.png)

![](./img/reablacktree/16.png)

此时只需要将10节点的父节点、叔叔节点以及祖父节点进行变色即可。

**情景二：**父节点的兄弟节点为红色，且插入节点与父节点不处于同一直线路径。

![](./img/reablacktree/15.png)



![](./img/reablacktree/17.png)

此时只需要将10节点的父节点、叔叔节点以及祖父节点进行变色即可。

**父节点没有有兄弟节点的情况**

**情景一：**插入的节点与父节点在同一直线路径

![](./img/reablacktree/18.png)

![](./img/reablacktree/19.png)

需要进行旋转，并且将插入节点的父节点与祖父节点进行变色。

**情景二：**插入的节点与父节点不在同一直线路径

![](./img/reablacktree/20.png)

![](./img/reablacktree/21.png)

需要进行两次旋转（两次方向相反的旋转），并且将插入节点的父节点与祖父节点进行变色。

### 插入节点的父节点的兄弟节点可能是黑色吗

在上文中，我们只讨论当插入节点的父节点是红色，且叔叔节点不能存在或者是红色的情况下，怎么去恢复红黑树，但是并没有讨论插入节点的父节点是红色，且叔叔节点是黑色的情况是怎样的，这是为甚么呢？

首先我们需要思考一下，插入节点的父节点是红色其叔叔节点是黑色，这种情况存在吗？首先我们假设真的存在这种情况，如下图：

![](./img/reablacktree/22.png)

这种情况显示违背红黑树的第5条性质，既`从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点`，显示从节点20开始，左子树与右子树的黑色节点树是不同的，因此不会存在插入节点的父节点的兄弟节点可能是黑色的情况。

